<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_0o7fuuo" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="1.14.0">
  <bpmn:process id="ObjectsSubmissionProcessing" name="Objects Submission process" isExecutable="true" camunda:versionTag="v0.1">
    <bpmn:startEvent id="StartEvent_1" name="Receive Bundle">
      <bpmn:outgoing>SequenceFlow_11gobmd</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="SequenceFlow_11gobmd" sourceRef="StartEvent_1" targetRef="Task_1p9v1se" />
    <bpmn:endEvent id="EndEvent_0dxe6sl">
      <bpmn:incoming>SequenceFlow_0ruoxrt</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0b01eeg" sourceRef="Task_1p9v1se" targetRef="SubProcess_082vf08" />
    <bpmn:serviceTask id="Task_1p9v1se" name="Validate Bundle" camunda:asyncAfter="true" camunda:class="io.digitalstate.taxii.camunda.delegates.PrepBundle">
      <bpmn:incoming>SequenceFlow_11gobmd</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0b01eeg</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:subProcess id="SubProcess_082vf08" name="Process Each Object">
      <bpmn:incoming>SequenceFlow_0b01eeg</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1rlcjun</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics camunda:collection="${bundleObject.getObjects()}" camunda:elementVariable="object" />
      <bpmn:startEvent id="StartEvent_0lr2rvs">
        <bpmn:outgoing>SequenceFlow_04xnsgm</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:sequenceFlow id="SequenceFlow_04xnsgm" sourceRef="StartEvent_0lr2rvs" targetRef="Task_1yzjs5q" />
      <bpmn:endEvent id="EndEvent_0zbju20">
        <bpmn:incoming>SequenceFlow_1n0h6ec</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="SequenceFlow_1rc4l1z" sourceRef="Task_1yzjs5q" targetRef="ExclusiveGateway_0wdlm4a" />
      <bpmn:serviceTask id="Task_1yzjs5q" name="Process Stix Object" camunda:class="io.digitalstate.taxii.camunda.delegates.ProcessStixObject">
        <bpmn:incoming>SequenceFlow_04xnsgm</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_1rc4l1z</bpmn:outgoing>
        <bpmn:dataOutputAssociation id="DataOutputAssociation_1rd41pf">
          <bpmn:targetRef>DataStoreReference_0swo0pb</bpmn:targetRef>
        </bpmn:dataOutputAssociation>
      </bpmn:serviceTask>
      <bpmn:dataStoreReference id="DataStoreReference_0swo0pb" name="DB" />
      <bpmn:sequenceFlow id="SequenceFlow_1n0h6ec" sourceRef="Task_1ty8tvq" targetRef="EndEvent_0zbju20" />
      <bpmn:userTask id="Task_1ty8tvq" name="placeholder">
        <bpmn:incoming>SequenceFlow_120es73</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_1n0h6ec</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:exclusiveGateway id="ExclusiveGateway_0wdlm4a" name="Object is SDO Indicator?" default="SequenceFlow_120es73">
        <bpmn:incoming>SequenceFlow_1rc4l1z</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_120es73</bpmn:outgoing>
        <bpmn:outgoing>SequenceFlow_0va82aw</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="SequenceFlow_120es73" name="No" sourceRef="ExclusiveGateway_0wdlm4a" targetRef="Task_1ty8tvq" />
      <bpmn:sequenceFlow id="SequenceFlow_0va82aw" name="Yes" sourceRef="ExclusiveGateway_0wdlm4a" targetRef="IntermediateThrowEvent_0koux3o">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${object.getType().equals("indicator")}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:intermediateThrowEvent id="IntermediateThrowEvent_0koux3o" name="SDO Indicator Received">
        <bpmn:incoming>SequenceFlow_0va82aw</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_1262xo1</bpmn:outgoing>
        <bpmn:signalEventDefinition signalRef="Signal_0sfs4m2">
          <bpmn:extensionElements>
            <camunda:in source="object" target="indicator_object" />
            <camunda:in source="tenant_id" target="tenant_id" />
            <camunda:in source="collection_id" target="collection_id" />
            <camunda:in source="status_id" target="status_id" />
          </bpmn:extensionElements>
        </bpmn:signalEventDefinition>
      </bpmn:intermediateThrowEvent>
      <bpmn:sequenceFlow id="SequenceFlow_1262xo1" sourceRef="IntermediateThrowEvent_0koux3o" targetRef="Task_1jd365y" />
      <bpmn:userTask id="Task_1jd365y" name="Placeholder">
        <bpmn:incoming>SequenceFlow_1262xo1</bpmn:incoming>
        <bpmn:outgoing>SequenceFlow_0u8xg8l</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:endEvent id="EndEvent_1fqam85">
        <bpmn:incoming>SequenceFlow_0u8xg8l</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="SequenceFlow_0u8xg8l" sourceRef="Task_1jd365y" targetRef="EndEvent_1fqam85" />
    </bpmn:subProcess>
    <bpmn:sequenceFlow id="SequenceFlow_1rlcjun" sourceRef="SubProcess_082vf08" targetRef="Task_18j00nj" />
    <bpmn:sequenceFlow id="SequenceFlow_0ruoxrt" sourceRef="Task_0a23bek" targetRef="EndEvent_0dxe6sl" />
    <bpmn:userTask id="Task_0a23bek" name="placeholder">
      <bpmn:incoming>SequenceFlow_09z4pw1</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0ruoxrt</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_09z4pw1" sourceRef="Task_18j00nj" targetRef="Task_0a23bek" />
    <bpmn:manualTask id="Task_18j00nj" name="Update Status for Completion Result">
      <bpmn:incoming>SequenceFlow_1rlcjun</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_09z4pw1</bpmn:outgoing>
    </bpmn:manualTask>
    <bpmn:textAnnotation id="TextAnnotation_0adweqf">
      <bpmn:text>Async After</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_04nj44t" sourceRef="Task_1p9v1se" targetRef="TextAnnotation_0adweqf" />
  </bpmn:process>
  <bpmn:signal id="Signal_0sfs4m2" name="sdo_indicator_received" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="ObjectsSubmissionProcessing">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="231" y="219" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="210" y="255" width="78" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_11gobmd_di" bpmnElement="SequenceFlow_11gobmd">
        <di:waypoint x="267" y="237" />
        <di:waypoint x="337" y="237" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="257" y="215.5" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0dxe6sl_di" bpmnElement="EndEvent_0dxe6sl">
        <dc:Bounds x="1506" y="219" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1479" y="258" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0b01eeg_di" bpmnElement="SequenceFlow_0b01eeg">
        <di:waypoint x="437" y="237" />
        <di:waypoint x="499" y="237" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="423" y="215.5" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_169ztmj_di" bpmnElement="Task_1p9v1se">
        <dc:Bounds x="337" y="197" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="SubProcess_082vf08_di" bpmnElement="SubProcess_082vf08" isExpanded="true">
        <dc:Bounds x="499" y="89" width="656" height="295" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1rlcjun_di" bpmnElement="SequenceFlow_1rlcjun">
        <di:waypoint x="1155" y="237" />
        <di:waypoint x="1211" y="237" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1138" y="215.5" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="StartEvent_0lr2rvs_di" bpmnElement="StartEvent_0lr2rvs">
        <dc:Bounds x="522" y="173" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="540" y="212" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_04xnsgm_di" bpmnElement="SequenceFlow_04xnsgm">
        <di:waypoint x="558" y="191" />
        <di:waypoint x="599" y="191" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="578.5" y="169.5" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0zbju20_di" bpmnElement="EndEvent_0zbju20">
        <dc:Bounds x="1077" y="173" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1095" y="212" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1rc4l1z_di" bpmnElement="SequenceFlow_1rc4l1z">
        <di:waypoint x="699" y="191" />
        <di:waypoint x="775" y="191" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="737" y="169.5" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="TextAnnotation_0adweqf_di" bpmnElement="TextAnnotation_0adweqf">
        <dc:Bounds x="262" y="146" width="100" height="30" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Association_04nj44t_di" bpmnElement="Association_04nj44t">
        <di:waypoint x="348" y="197" />
        <di:waypoint x="327" y="176" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_1tywk26_di" bpmnElement="Task_1yzjs5q">
        <dc:Bounds x="599" y="151" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_0swo0pb_di" bpmnElement="DataStoreReference_0swo0pb">
        <dc:Bounds x="624" y="280" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="641" y="333" width="16" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="DataOutputAssociation_1rd41pf_di" bpmnElement="DataOutputAssociation_1rd41pf">
        <di:waypoint x="649" y="231" />
        <di:waypoint x="649" y="280" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1n0h6ec_di" bpmnElement="SequenceFlow_1n0h6ec">
        <di:waypoint x="1031" y="191" />
        <di:waypoint x="1077" y="191" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1054" y="169.5" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0ruoxrt_di" bpmnElement="SequenceFlow_0ruoxrt">
        <di:waypoint x="1466" y="237" />
        <di:waypoint x="1506" y="237" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1441" y="215.5" width="90" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_1ovtpn4_di" bpmnElement="Task_1ty8tvq">
        <dc:Bounds x="931" y="151" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_04l98vk_di" bpmnElement="Task_0a23bek">
        <dc:Bounds x="1366" y="197" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0wdlm4a_di" bpmnElement="ExclusiveGateway_0wdlm4a" isMarkerVisible="true">
        <dc:Bounds x="775.25" y="166" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="765" y="132" width="70" height="25" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_120es73_di" bpmnElement="SequenceFlow_120es73">
        <di:waypoint x="825" y="191" />
        <di:waypoint x="931" y="191" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="871" y="169" width="15" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0va82aw_di" bpmnElement="SequenceFlow_0va82aw">
        <di:waypoint x="800" y="216" />
        <di:waypoint x="800" y="287" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="806" y="245" width="18" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="IntermediateThrowEvent_1enj9k5_di" bpmnElement="IntermediateThrowEvent_0koux3o">
        <dc:Bounds x="782" y="287" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="765" y="326" width="70" height="24" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1262xo1_di" bpmnElement="SequenceFlow_1262xo1">
        <di:waypoint x="818" y="305" />
        <di:waypoint x="931" y="305" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="874.5" y="283.5" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_1lfvc87_di" bpmnElement="Task_1jd365y">
        <dc:Bounds x="931" y="265" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1fqam85_di" bpmnElement="EndEvent_1fqam85">
        <dc:Bounds x="1077" y="287" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1095" y="326" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0u8xg8l_di" bpmnElement="SequenceFlow_0u8xg8l">
        <di:waypoint x="1031" y="305" />
        <di:waypoint x="1077" y="305" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1054" y="283" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_09z4pw1_di" bpmnElement="SequenceFlow_09z4pw1">
        <di:waypoint x="1311" y="237" />
        <di:waypoint x="1366" y="237" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1338.5" y="215.5" width="0" height="13" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ManualTask_1s8zffv_di" bpmnElement="Task_18j00nj">
        <dc:Bounds x="1211" y="197" width="100" height="80" />
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
